<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>balises - Reactive HTML templating</title>
    <meta
      name="description"
      content="A minimal reactive HTML templating library with fine-grained updates. ~3.0KB gzipped."
    />
    <link rel="icon" type="image/svg+xml" href="./assets/logo-icon.svg" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />

    <!-- Prism.js for syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css"
    />
  </head>

  <body>
    <div class="container">
      <!-- Header -->
      <header>
        <img
          src="./assets/logo.svg"
          alt="balises"
          width="280"
          style="margin-bottom: 1.5rem"
        />
        <p class="tagline">
          Minimal reactive HTML templating with fine-grained updates
        </p>
        <div class="badges">
          <span class="badge"><strong>~3.0KB</strong> gzipped</span>
          <span class="badge"><strong>Zero</strong> dependencies</span>
          <span class="badge"><strong>TypeScript</strong> native</span>
        </div>
      </header>

      <!-- Navigation Links -->
      <header>
        <div class="links">
          <a href="https://github.com/elbywan/balises" class="btn github">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"
              />
            </svg>
            GitHub
          </a>
          <a href="https://www.npmjs.com/package/balises" class="btn npm">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M0 7.334v8h6.666v1.332H12v-1.332h12v-8H0zm6.666 6.664H5.334v-4H3.999v4H1.335V8.667h5.331v5.331zm4 0v1.336H8.001V8.667h5.334v5.332h-2.669v-.001zm12.001 0h-1.33v-4h-1.336v4h-1.335v-4h-1.33v4h-2.671V8.667h8.002v5.331zM10.665 10H12v2.667h-1.335V10z"
              />
            </svg>
            npm
          </a>
          <a href="#examples" class="btn examples">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polygon points="5 3 19 12 5 21 5 3" />
            </svg>
            Examples
          </a>
        </div>
      </header>

      <!-- Install Section -->
      <section>
        <h2>Install</h2>
        <div class="install-tabs">
          <button class="install-tab active" data-pkg="npm">npm</button>
          <button class="install-tab" data-pkg="yarn">yarn</button>
          <button class="install-tab" data-pkg="pnpm">pnpm</button>
          <button class="install-tab" data-pkg="bun">bun</button>
        </div>
        <pre
          class="install-cmd"
        ><code class="language-bash" data-code="install"></code><button class="copy-btn">Copy</button></pre>
      </section>

      <!-- Quick Start Section -->
      <section>
        <h2>Quick Start</h2>
        <div class="code-wrapper">
          <pre><code class="language-javascript" data-code="quickstart"></code></pre>
          <button class="copy-btn">Copy</button>
        </div>
      </section>

      <!-- Web Component Section -->
      <section>
        <h2>Web Component</h2>
        <p>Encapsulate state and rendering in a custom element:</p>
        <div class="code-wrapper">
          <pre><code class="language-javascript" data-code="webcomponent"></code></pre>
          <button class="copy-btn">Copy</button>
        </div>

        <br />
        <p class="demo-label">Try it:</p>
        <div class="demo">
          <my-counter></my-counter>
        </div>
      </section>

      <!-- Features Section -->
      <section>
        <h2>Features</h2>
        <div class="features">
          <div class="feature">
            <div class="feature-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <div class="feature-text">
              <strong>Fine-grained reactivity</strong> — Only updates what
              changed, no virtual DOM diffing
            </div>
          </div>

          <div class="feature">
            <div class="feature-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <div class="feature-text">
              <strong>Signals & computed</strong> — Automatic dependency
              tracking with lazy evaluation
            </div>
          </div>

          <div class="feature">
            <div class="feature-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <div class="feature-text">
              <strong>Keyed list rendering</strong> — Efficient
              <code>each()</code> with DOM node recycling
            </div>
          </div>

          <div class="feature">
            <div class="feature-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <div class="feature-text">
              <strong>No build step required</strong> — Works directly in
              browsers with ES modules
            </div>
          </div>

          <div class="feature">
            <div class="feature-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </div>
            <div class="feature-text">
              <strong>Non-recursive propagation</strong> — Handles deep
              dependency chains without stack overflow
            </div>
          </div>
        </div>
      </section>

      <!-- API Section -->
      <section>
        <h2>API</h2>
        <div class="api-grid">
          <!-- signal() -->
          <div class="api-item">
            <h3>signal(value)</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="signal"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Creates a reactive value. Reading <code>.value</code> inside a
              computed tracks it as a dependency.
            </p>
          </div>

          <!-- computed() -->
          <div class="api-item">
            <h3>computed(fn)</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="computed"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Creates a derived value that automatically recomputes when
              dependencies change.
            </p>
          </div>

          <!-- effect() -->
          <div class="api-item">
            <h3>effect(fn)</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="effect"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Runs a side effect immediately and re-runs when dependencies
              change. Returns dispose function for cleanup.
            </p>
          </div>

          <!-- store() -->
          <div class="api-item">
            <h3>store(object)</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="store"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Wraps a plain object making all properties reactive. Nested
              objects are wrapped automatically.
            </p>
          </div>

          <!-- html`...` -->
          <div class="api-item">
            <h3>html`...`</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="html"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Tagged template for reactive HTML. Use <code>@event</code> for
              events, <code>.prop</code> for properties.
            </p>
          </div>

          <!-- each() -->
          <div class="api-item">
            <h3>each(list, keyFn?, renderFn)</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="each"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Efficient keyed list rendering. Reuses DOM nodes when items are
              reordered.
            </p>
          </div>

          <!-- batch() -->
          <div class="api-item">
            <h3>batch(fn)</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="batch"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Batches multiple signal updates into a single notification pass.
            </p>
          </div>

          <!-- scope() -->
          <div class="api-item">
            <h3>scope(fn)</h3>
            <div class="code-wrapper">
              <pre><code class="language-javascript" data-code="scope"></code></pre>
              <button class="copy-btn">Copy</button>
            </div>
            <p>
              Creates a disposal scope that collects all computeds and effects,
              allowing cleanup with a single <code>dispose()</code> call.
            </p>
          </div>
        </div>
      </section>

      <!-- Examples Section -->
      <section id="examples">
        <h2>Examples</h2>
        <div class="examples">
          <a href="./examples/counter/" class="example-card">
            <div>
              <div class="name">Counter</div>
              <div class="desc">Simple reactive counter</div>
            </div>
            <span class="arrow">&rarr;</span>
          </a>

          <a href="./examples/todo-list/" class="example-card">
            <div>
              <div class="name">Todo List</div>
              <div class="desc">CRUD with keyed list rendering</div>
            </div>
            <span class="arrow">&rarr;</span>
          </a>

          <a href="./examples/timer/" class="example-card">
            <div>
              <div class="name">Timer</div>
              <div class="desc">Interval-based updates</div>
            </div>
            <span class="arrow">&rarr;</span>
          </a>

          <a href="./examples/pokemon/" class="example-card">
            <div>
              <div class="name">Pokemon</div>
              <div class="desc">Async data fetching</div>
            </div>
            <span class="arrow">&rarr;</span>
          </a>
        </div>
      </section>

      <!-- Footer -->
      <footer>
        <p>
          MIT License &middot; Made by
          <a href="https://github.com/elbywan">@elbywan</a>
        </p>
        <p style="margin-top: 0.5rem; opacity: 0.7; font-size: 0.9rem">
          This page is built with balises &middot;
          <a href="https://github.com/elbywan/balises/blob/main/docs/index.html"
            >View Source</a
          >
        </p>
      </footer>
    </div>

    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>

    <!-- App functionality -->
    <script type="module">
      import { html, signal, computed, store } from "./examples/balises.esm.js";

      // Import the counter demo (this makes it work)
      import "./counter-demo.js";

      // Reactive state for install command
      const selectedPkg = signal("npm");
      const installCommands = {
        npm: "npm install balises",
        yarn: "yarn add balises",
        pnpm: "pnpm add balises",
        bun: "bun add balises",
      };
      const installCmd = computed(() => installCommands[selectedPkg.value]);

      // Convert CODE_EXAMPLES to a reactive store!
      const codeExamples = store({
        install: `npm install balises`,
        quickstart: null, // Will be loaded from quickstart-demo.js
        webcomponent: null, // Will be loaded from counter-demo.js
        signal: `const count = signal(0);
count.value;      // read: 0
count.value = 5;  // write: triggers updates
count.update(n => n + 1); // functional update
count.subscribe(() => console.log('changed!'));`,
        computed: `const double = computed(() => count.value * 2);
double.value;     // auto-updates when count changes
double.dispose(); // cleanup when done`,
        effect: `const dispose = effect(() => {
  console.log('Count:', count.value);
  localStorage.setItem('count', count.value);
});
// Runs immediately, re-runs when count changes
dispose(); // cleanup when done`,
        store: `const state = store({ count: 0, user: { name: 'Alice' } });
state.count++;           // reactive
state.user.name = 'Bob'; // nested objects too`,
        html: `const tmpl = html\`
  <div class=\${className}>       <!-- reactive attribute -->
    \${text}                      <!-- reactive text -->
    <input .value=\${value} />    <!-- property binding -->
    <button @click=\${handler}>   <!-- event binding -->
  </div>
\`;
const { fragment, dispose } = tmpl.render();`,
        each: `// With key function (recommended)
\${each(items, i => i.id, i => html\`<li>\${i.name}</li>\`)}

// Without key (uses object reference or index)
\${each(items, i => html\`<li>\${i.name}</li>\`)}

// With getter function (for stores)
\${each(() => state.items, i => html\`<li>\${i}</li>\`)}`,
        batch: `batch(() => {
  count.value = 1;
  name.value = 'Alice';
  items.value = [...items.value, newItem];
}); // subscribers notified once at the end`,
        scope: `const [state, dispose] = scope(() => {
  const count = signal(0);
  const doubled = computed(() => count.value * 2);
  effect(() => console.log(doubled.value));
  return { count, doubled };
});
// Use state.count, state.doubled...
dispose(); // cleanup everything at once`,
      });

      // Also expose on window for backward compatibility (if needed)
      window.CODE_EXAMPLES = codeExamples;

      // Fetch and load demo code reactively
      async function loadDemoCode() {
        try {
          // Load quickstart demo
          const quickstartResponse = await fetch("./quickstart-demo.js");
          const quickstartCode = await quickstartResponse.text();
          // Update the store - this will trigger reactive updates!
          codeExamples.quickstart = quickstartCode.replace(
            "./examples/balises.esm.js",
            "balises",
          );

          // Load web component demo
          const webcomponentResponse = await fetch("./counter-demo.js");
          const webcomponentCode = await webcomponentResponse.text();
          // Update the store - this will trigger reactive updates!
          codeExamples.webcomponent = webcomponentCode.replace(
            "./examples/balises.esm.js",
            "balises",
          );
        } catch (error) {
          console.error("Failed to load demo code:", error);
        }
      }

      // Initialize all UI functionality when DOM is ready
      function initializeUI() {
        // Start loading demo code (async)
        loadDemoCode();

        // Reactively populate code elements when codeExamples change
        document.querySelectorAll("code[data-code]").forEach((codeEl) => {
          const exampleKey = codeEl.dataset.code;

          // Create a computed value that tracks this specific example
          const exampleCode = computed(() => codeExamples[exampleKey]);

          // Subscribe to changes and update the DOM
          exampleCode.subscribe(() => {
            if (exampleCode.value) {
              codeEl.textContent = exampleCode.value;
              Prism.highlightElement(codeEl);
            }
          });

          // Set initial value
          if (exampleCode.value) {
            codeEl.textContent = exampleCode.value;
            Prism.highlightElement(codeEl);
          }
        });

        // Install tabs functionality - use balises for reactive updates
        const installCodeEl = document.querySelector(".install-cmd code");

        // Subscribe to installCmd changes and update the DOM
        installCmd.subscribe(() => {
          installCodeEl.textContent = installCmd.value;
          Prism.highlightElement(installCodeEl);
        });

        // Set initial value
        installCodeEl.textContent = installCmd.value;
        Prism.highlightElement(installCodeEl);

        // Add click handlers to tabs
        document.querySelectorAll(".install-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            // Update all tab classes
            document
              .querySelectorAll(".install-tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            // Update signal - this will trigger the subscription above
            selectedPkg.value = tab.dataset.pkg;
          });
        });

        // Copy buttons functionality - using balises signals for state
        document.querySelectorAll(".copy-btn").forEach((btn) => {
          const copied = signal(false);

          // Subscribe to state changes
          copied.subscribe(() => {
            if (copied.value) {
              btn.textContent = "Copied!";
              btn.classList.add("copied");
            } else {
              btn.textContent = "Copy";
              btn.classList.remove("copied");
            }
          });

          btn.addEventListener("click", async () => {
            const code = btn
              .closest(".code-wrapper, pre")
              .querySelector("code");
            const text = code.textContent;
            await navigator.clipboard.writeText(text);

            // Update signal - this will trigger the subscription
            copied.value = true;
            setTimeout(() => {
              copied.value = false;
            }, 2000);
          });
        });
      }

      // Initialize when DOM is ready
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializeUI);
      } else {
        initializeUI();
      }
    </script>
  </body>
</html>
